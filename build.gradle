apply plugin: 'java'
apply plugin: 'jacoco'
apply plugin: 'eclipse'

sourceCompatibility = '1.8'
[compileJava, compileTestJava]*.options*.encoding = 'UTF-8'

ext {
    cdiVersion = '1.2'
    deltaspikeVersion = '1.3.0'
    owbVersion = '1.2.7'
    weldVersion = '2.2.10.Final'
    junitVersion = '4.12'
    assertjVersion = '2.0.0'
    mockitoVersion = '1.10.19'
    slf4jVersion = '1.7.12'
    logbackVersion = '1.1.3'
}

repositories {
    mavenCentral()
}

dependencies {

	//CDI API
	compile group: 'javax.enterprise', name: 'cdi-api', version: cdiVersion
	
	//Apache Deltaspike CdiCtrl
    testCompile group: 'org.apache.deltaspike.modules', name: 'deltaspike-test-control-module-api', version: deltaspikeVersion
    testCompile group: 'org.apache.deltaspike.modules', name: 'deltaspike-test-control-module-impl', version: deltaspikeVersion
    
    //Apache OpenWebbeans CDI Container
    testCompile group: 'org.apache.deltaspike.cdictrl', name: 'deltaspike-cdictrl-owb', version: deltaspikeVersion
    testCompile group: 'org.apache.openwebbeans', name: 'openwebbeans-spi', version: owbVersion
    testCompile group: 'org.apache.openwebbeans', name: 'openwebbeans-impl', version: owbVersion
    
    //JBoss Weld CDI Container
    //testCompile group: 'org.apache.deltaspike.cdictrl', name: 'deltaspike-cdictrl-weld', version: deltaspikeVersion
    //testCompile group: 'org.jboss.weld.se', name: 'weld-se', version: weldVersion
    
    //Unit testing
    testCompile group: 'junit', name: 'junit', version: junitVersion
    testCompile group: 'org.assertj', name: 'assertj-core', version: assertjVersion     
    testCompile group: 'org.mockito', name: 'mockito-all', version: mockitoVersion
    //Logging with slf4j
	compile group: 'org.slf4j', name: 'slf4j-api', version: slf4jVersion
    compile group: 'ch.qos.logback', name: 'logback-classic', version: logbackVersion
	
}

test.doFirst {
    println 'Copy the CDI beans.xml'
    copy {
        from 'build/resources/main/META-INF/beans.xml'
        into 'build/classes/main/META-INF/'
    }

}

test {
    jacoco {
        append = false
        destinationFile = file("$buildDir/jacoco/jacocoTest.exec")
        classDumpFile = file("$buildDir/jacoco/classpathdumps")
    }    
}

jacocoTestReport {
    reports {
        xml.enabled false
        csv.enabled false
        html.destination "${buildDir}/jacocoHtml"
    }
}


